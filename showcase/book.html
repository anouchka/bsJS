<!DOCTYPE html>
<html lang="ko">
<title>book</title>
<meta name="keywords" content="bs5" />
<meta name="description" content="bs5 Test suite" />
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,target-densitydpi=medium-dpi" />
<link rel="shortcut icon" href="http://blog.bsidesoft.com/favicon.ico" type="image/x-icon">
<script id="Tsearch" type="text/bsTemplate">
<h1 class="batch">@book@</h1>
<div id="search" class="panel">
	<ul id="type">@type@</ul><br clear="both">
	<div class="right"><a id="go">@go@</a></div>
	<div class="left"><input id="query" type="text" class="text" ></div>
</div>
<div id="list" class="panel"></div>
<div id="detail" class="panel"></div>
</script>
<script id="Tdetail" type="text/bsTemplate">
<div class="detail">
	<img src="@cover_l_url@" class="d0">
	<div class="d1">
		<h2>@title@ <a class="batch" href="@link@" target="_blank">@L@</a></h2>
		<img src="@cover_l_url@" class="d2">
		<div class="d3">
			<div>저자/역자 : @author@ / @translator@</div>
			<div>출판사(출판일) : @pub_nm@ (@pub_date@)</div>
			<div>ISBN/13 : @isbn@ / @isbn13@</div>
			<div>정가 : @list_price@</div>
			<div>@description@</div>
		</div>
	</div>
</div>
</script>
</head><body>
<div id="stage"></div>
<script src="../bs/bs5.js"></script> 
<script>
bs( function(){
	var M,V,C;
	M = {
		type:['all', 'title', 'isbn', 'writer', 'publisher', 'keyword', 'overview', 'contents'],
		url:function( $type, $id ){
			return 'http://apis.daum.net/search/book?apikey=76aaa32e1a78cf26f1f9f714eaf6c85089acf6f1&output=json&searchType=' + $type +
				'&q=' + encodeURIComponent($id) + '&callback=';
		},
		$:function( $type, $id, $val ){
			$id = $id || '@';
			return $val == undefined ? this[$type] && this[$type][$id] : ( this[$type] || ( this[$type] = {} ) )[$id] = $val;
		}
	};
	C = {
		loaded:function( $data ){
			var t0 = $data.channel.result == 0 ? 'nodata' : M.$( C._type, C.id, $data.channel.item );
			if( C._back == 'result' ) V.result( C._type, C._id, t0 );
			else if( C._back == 'detail' ) V.detail( C._type, C._id, C._isbn, t0 );
		},
		Rresult:function( $uri ){
			var t0;
			t0 = $uri.substr( '#result/'.length ).split('/'),
			C._type = t0[0], C._id = decodeURIComponent(t0[1]), C._back = 'result';
			if( t0 = M.$( type, C._id ) ) V.result( C._type, C._id, t0 );
			else V.result( C._type, C._id, 'wait' ), bs.$js( C.loaded, M.url(  C._type, C._id ) );
		},
		Rdetail:function( $uri ){
			var t0;
			t0 = $uri.substr( '#detail/'.length ).split('/'),
			C._type = t0[0], C._id = decodeURIComponent(t0[1]), C._isbn = t0[2], C._back = 'detail';
			if( t0 = M.$( type, C._id ) ) V.detail( C._type, C._id, C._isbn, t0 );
			else V.detail( C._type, C._id, C._isbn, 'wait' ), bs.$js( C.loaded, M.url(  C._type, C._id ) );
		},
		query:function( $type, $val ){
			bs.ROUTER.go( '#result/'+$type+'/'+( $val ? bs.$trim( $val ) : '' ) );
		},
		detail:function( $data ){
			bs.ROUTER.go( '#detail/'+$data );
		},
		init:function(){
			V.init( M.type );
			bs.ROUTER.table(
				'#detail', this.Rdetail,
				'#result', this.Rresult
			);	
			bs.ROUTER.route();
		}
	};
	V = {
		init:function( $type ){
			bs.c('font-face@batch batch');
			bs.$css( 'book.css' );
			
			bs.d( bs.$tmpl('#Tsearch', {type:bs.$deco( $type, '<li class="type">', '</li>' ), go:'\uF097', book:'\uF0D0 \uF0D1 \uF0D2 \uF0D3'} ) ).$('<','#stage' );
			bs.d('.type').$( 'down', function($e){
				bs.d( '.type' ).$( 'class-', 'selectType' );
				C.query( bs.d( this ).$( 'class+', 'selectType', 'html' ), bs.d('#query').$('@value') );
			});
			bs.d(bs.d('.type')[0]).$('class+', 'selectType');
			bs.d('#query').$(
				'focus', function($e){bs.d(this).$('class+','edit');},
				'blur', function($e){bs.d(this).$('class-','edit');},
				'keydown', function k($e){
					if( !$e.key('enter') ) return;
					C.query( bs.d( '@.selectType' ).$('html'), $e.value||'' );
					bs.d(this).$('b');
				}
			);
			bs.d('#go').$(
				'down', function k($e){
					C.query( bs.d( '@.selectType' ).$('html'), bs.d('#query').$('@value')||'' );
					bs.d('#query').$('b');
				}
			);
		},
		resultDown:function($e){C.detail( bs.d( this ).$('@data') );},
		resultOver:function($e){bs.d(this).$('class+','thumbOver');},
		resultOut:function($e){bs.d(this).$('class-','thumbOver');},
		resultStat:'',
		result:function( $type, $id, $data ){
			var t0, i, j, k;
			this.resultStat = $type+'/'+$id;
			if( bs.WIN.is('.modal') ) bs.d('@.modal').$(null);
			//type
			t0 = bs.d( '.type' ), t0.$( 'class-', 'selectType' ), i = t0.length;
			while( i-- ) if( t0[i].innerHTML == $type ){
				bs.d( t0[i] ).$( 'class+', 'selectType', 'html' );
				break;
			}
			//id
			bs.d('#query').$( '@value', $id );
			//data
			if( $data == 'nodata' ){
				bs.d('#list').$('html','데이터가 없습니다');
			}else if( $data == 'wait' ){
				bs.d('#list').$('html','wait');
			}else{
				for( t0 = '', i = 0, j = $data.length ; i < j ; i++ ) t0 += '<img data="'+$type+'/'+$id+'/'+$data[i].isbn+'" src="'+ $data[i].cover_l_url +'" class="thumb">';
				bs.d('#list').$( 'html', t0 );
				bs.d('@.thumb').$( 'mouseover', this.resultOver, 'mouseout', this.resultOut, 'up', this.resultDown );
			}
		},
		modal:function($e){$e.prevent();},
		close:function($e){
			var t0;
			$e.prevent();
			bs.d('@.modal').$(null);
			t0 = V.resultStat.split( '/' );
			C.query( t0[0], t0[1] );
		},
		strip:/[&]lt[;][^&]+[&]gt[;]/g,
		detail:function( $type, $id, $isbn, $data ){
			var t0, i;
			if( this.resultStat != $type + '/' + $id ) return C.query( $type, $id );
			if( $data == 'nodata' ){
				bs.d('#list').$('html','데이터가 없습니다');
			}else if( $data == 'wait' ){
				bs.d('#list').$('html','wait');
			}else{
				i = $data.length;
				while( i-- ) if( $data[i].isbn == $isbn ){
					t0 = $data[i];
					break;
				}
				if( t0 ){
					t0 = bs.$deco( t0, this.strip, '' );
					t0.L = '\uF144';
					bs.d('<div class="modal"></div>').$( '<', 'body', 'height', innerHeight, 'up', V.close, 'mouseover', V.modal, 'mouseout', V.modal,
					'>', bs.d('<div class="detail"></div>').$( 'html', bs.$tmpl( '#Tdetail', t0 ), 'this' )
					);
				}
			}
		}
	};
	
	C.init();
} );
</script>
</body>
</html>
